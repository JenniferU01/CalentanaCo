<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title><%= title %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="/css/main.css" />
</head>
<body>

<header class="header">
  <div class="header-inner">
    <h1 class="logo">
      <img src="/img/logo-calentanaco.png" class="logo-img" alt="CalentanaCo">
      <span>CalentanaCo</span>
    </h1>

    <nav class="nav">
      <a href="/menu" class="nav-link active">MenÃº</a>
      <a href="/cart" class="nav-link nav-cart">
        Carrito
        <span class="cart-badge"><%= cartCount || 0 %></span>
      </a>
    </nav>
  </div>
</header>

<main class="main">
  <section class="hero">
    <h2>MenÃº</h2>
    <p class="note">Agrega al carrito y elige tamaÃ±o cuando aplique (aguas).</p>
  </section>

  <%
    // âœ… WhatsApp phone (si existe en .env, mostramos botÃ³n flotante)
    const waPhone = String(process.env.WHATSAPP_PHONE || "").trim();

    // âœ… Company info (si no llega 'company', usamos defaults seguros)
    const companySafe = company || {
      slogan: "El sabor que te abraza, la frescura que te inspira.",
      mission:
        "Llevar a cada persona el autÃ©ntico sabor calentano a travÃ©s de aguas frescas, botanas y antojitos elaborados con calidad, tradiciÃ³n y cariÃ±o; ofreciendo una experiencia cercana, rÃ¡pida y accesible para todos.",
      vision:
        "Convertirnos en la marca lÃ­der de aguas frescas y botanas en la regiÃ³n, reconocida por su sabor incomparable, su servicio humano y cercano, y por la innovaciÃ³n constante en la experiencia del cliente tanto en tienda como en plataformas digitales."
    };
  %>

  <!-- âœ… MISIÃ“N / VISIÃ“N / FRASE -->
  <section class="hero section-space">
    <h3><%= companySafe.slogan %></h3>

    <p class="menu-desc">
      <strong>MisiÃ³n:</strong> <%= companySafe.mission %>
    </p>

    <p class="menu-desc">
      <strong>VisiÃ³n:</strong> <%= companySafe.vision %>
    </p>
  </section>

  <!-- âœ… HORARIOS -->
  <section class="hero section-space">
    <h3>ðŸ•’ Horarios de atenciÃ³n</h3>

    <p class="menu-desc">
      Lunes a Domingo<br/>
      <strong>08:00 am â€“ 13:00 pm</strong>
    </p>

    <p class="menu-desc">
      Pedidos fuera de este horario se atenderÃ¡n al siguiente dÃ­a.
    </p>
  </section>

  <%
    const order = ["aguas", "botanas", "antojitos", "otros"];
    const labels = {
      aguas: "Aguas frescas",
      botanas: "Botanas",
      antojitos: "Antojitos",
      otros: "Otros"
    };
  %>

  <% order.forEach(cat => { %>
    <% const list = grouped && grouped[cat] ? grouped[cat] : []; %>
    <% if (list.length > 0) { %>

      <section class="hero section-space">
        <h3 class="menu-title"><%= labels[cat] %></h3>

        <div class="menu-grid">
          <% list.forEach(product => { %>

            <%
              let imgSrc = "";
              if (product.imageUrl && String(product.imageUrl).trim() !== "") {
                imgSrc = product.imageUrl;
              } else if (product.image && String(product.image).trim() !== "") {
                imgSrc = "/img/products/" + product.image;
              }
            %>

            <article class="menu-card">
              <div class="menu-imgwrap">
                <% if (imgSrc) { %>
                  <img class="menu-img" src="<%= imgSrc %>" alt="<%= product.name %>">
                <% } else { %>
                  <div class="no-image">Sin imagen</div>
                <% } %>
              </div>

              <div class="menu-body">
                <h4 class="menu-name"><%= product.name %></h4>

                <% if (product.description) { %>
                  <p class="menu-desc"><%= product.description %></p>
                <% } %>

                <form action="/cart/add" method="POST" class="menu-form">
                  <input type="hidden" name="productId" value="<%= product._id %>">

                  <% if (product.sizes && product.sizes.length > 0) { %>
                    <label class="menu-label">
                      TamaÃ±o:
                      <select name="sizeLabel" class="menu-select" required>
                        <% product.sizes.forEach(s => { %>
                          <option value="<%= s.label %>">
                            <%= s.label %> â€” $<%= Number(s.price).toFixed(2) %>
                          </option>
                        <% }) %>
                      </select>
                    </label>
                  <% } else { %>
                    <input type="hidden" name="sizeLabel" value="">
                  <% } %>

                  <button type="submit" class="btn-primary btn-full">Agregar al carrito</button>
                </form>

              </div>
            </article>

          <% }) %>
        </div>
      </section>

    <% } %>
  <% }) %>

</main>

<footer class="footer">
  <p>Â© <%= new Date().getFullYear() %> CalentanaCo</p>
</footer>

<!-- âœ… BOTÃ“N FLOTANTE WHATSAPP -->
<% if (waPhone) { %>
  <a
    class="wa-float"
    href="https://wa.me/<%= waPhone %>"
    target="_blank"
    rel="noopener"
    aria-label="Contactar por WhatsApp"
    title="EscrÃ­benos por WhatsApp"
  >
    ðŸ’¬ WhatsApp
  </a>
<% } %>

</body>
</html>
